<section class="two-column" *ngIf="peerTask">
  <section class="task-info">
    <div class="info-header">
      <a class="arrow-back" mat-stroked-button [routerLink]="'/user/topics/' + topicId + '/tasks'">
        <mat-icon class="green-color" aria-hidden="false" aria-label="Example heart icon">chevron_left</mat-icon>
        <span>Назад</span>
      </a>
      <span class="complete">{{peerTask.complete ? 'Выполнено' : ''}}</span>
    </div>
    <h1 class="title">{{peerTask.title}}</h1>
    <ul class="task-info-desc">
      <li><b>Тема:</b> {{peerTask.topicId.title}}</li>
      <li><b>Уровень
        сложности:</b> {{peerTask.level == 'JUNIOR' ? 'Легкий' : peerTask.level == 'MIDDLE' ? 'Средний' : 'Сложный'}}
      </li>
    </ul>
    <h3>Описание</h3>
    <p [innerHTML]=peerTask.description></p>

    <h3 *ngIf="peerTask.options.constructions.length > 0">Запрещенные конструкции</h3>
    <ul *ngIf="peerTask.options.constructions.length > 0">
      <li *ngFor="let construction of peerTask.options.constructions">{{construction}}</li>
    </ul>


    <mat-divider class="example-code"></mat-divider>

  </section>

  <section *ngIf="hasSolutionBeenSent" class="review-section">
    <div class="after-solution-send-block">
      <p>&#10004; Опубликовать своё решение</p>
      <p>&#10006; Оценить решения других студентов</p>
      <button mat-flat-button color="primary"
              [routerLink]="'/user/topics/' + topicId + '/tasks/peer/' + peerTask.id + '/review'"
              (click)="makeReview()">Рецензировать
      </button>
      <p>&#10006; Дождаться оценки своего решения другими студентами</p>
      <p>&#10006; Получить оценку за решение</p>
    </div>
  </section>

  <section *ngIf="!hasSolutionBeenSent" class="task-code"
           [formGroup]="codeForm">

    <div class="header-code">
      <mat-form-field *ngIf="!hasSolutionBeenSent">
        <mat-label>Выберите язык</mat-label>
        <mat-select [value]="editorOptions.language" (selectionChange)="selectLanguage($event.value)">
          <mat-option value="cpp">C++</mat-option>
          <mat-option value="python">Python</mat-option>
          <!--          <mat-option value="kotlin">Kotlin</mat-option>-->
          <mat-option value="csharp">C#</mat-option>
          <!--          <mat-option value="php">PHP</mat-option>-->
        </mat-select>
      </mat-form-field>

      <button *ngIf="!spinner && !hasSolutionBeenSent" mat-flat-button color="primary" (click)="sendSolution()">
        Отправить
      </button>
      <mat-spinner *ngIf="spinner" [strokeWidth]="3" [diameter]="30"></mat-spinner>
    </div>

    <ngx-monaco-editor [options]="editorOptions"
                       formControlName="code"></ngx-monaco-editor>
  </section>
</section>


<section class="task-results-table" *ngIf="dataSource">
  <h2>Полученные рецензии</h2>
  <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" matSort (matSortChange)="sortData($event)">
    <ng-container matColumnDef="reviewNumber" class="first-column">
      <th mat-header-cell *matHeaderCellDef> Номер рецензии</th>
      <td mat-cell *matCellDef="let element"> #{{dataSource.data.indexOf(element) + 1}}</td>
    </ng-container>

    <ng-container matColumnDef="description">
      <th mat-header-cell *matHeaderCellDef>Описание критериев</th>
      <td mat-cell *matCellDef="let element">
        <div *ngFor="let item of element.gradesPerCriterions; let i = index">
          <p>Сообщение по критерию: {{element.argumentsPerCriterions[i]}}</p>
          <p>Результат по критерию: {{item * 10}}/10</p>
        </div>
      </td>
    </ng-container>

    <ng-container matColumnDef="summaryComment">
      <th mat-header-cell *matHeaderCellDef> Комментарий к работе</th>
      <td mat-cell *matCellDef="let element"> {{element.summaryMessagePerSolution}} </td>
    </ng-container>

    <ng-container matColumnDef="grade">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Финальная оценка</th>
      <td mat-cell *matCellDef="let element"> {{element.grade * 10}} </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>

  <mat-paginator *ngIf="receivedReviews"
                 [pageSize]="dataSource.data.length"
                 [length]="receivedReviews.totalElements"
                 (page)="onPageFired($event)"
                 showFirstLastButtons
  ></mat-paginator>
</section>
